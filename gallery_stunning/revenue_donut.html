
<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>Revenue by Segment - Interactive Donut Chart</title>
    <script src="https://unpkg.com/d3@7.9.0/dist/d3.min.js"></script>
    <script src="https://unpkg.com/@observablehq/plot@0.6/dist/plot.umd.min.js"></script>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", system-ui, sans-serif;
            margin: 0;
            padding: 40px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 25px 50px rgba(0,0,0,0.2);
            overflow: hidden;
        }
        .header {
            padding: 40px 40px 20px;
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            color: white;
            text-align: center;
        }
        h1 { 
            margin: 0;
            font-size: 32px;
            font-weight: 700;
        }
        .subtitle { 
            margin: 8px 0 0;
            font-size: 18px; 
            opacity: 0.9;
        }
        .plot-container {
            padding: 60px 40px;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 500px;
        }
        .stats {
            display: flex;
            justify-content: space-around;
            padding: 30px;
            background: #f8fafc;
            border-top: 1px solid #e2e8f0;
        }
        .stat {
            text-align: center;
        }
        .stat-value {
            font-size: 24px;
            font-weight: bold;
            color: #1e293b;
        }
        .stat-label {
            font-size: 14px;
            color: #64748b;
            margin-top: 4px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ðŸ’¼ Revenue by Segment</h1>
            <div class="subtitle">Q4 2023 breakdown with YoY growth rates</div>
        </div>
        <div class="plot-container">
            <div id="plot"></div>
        </div>
        <div class="stats">
            <div class="stat">
                <div class="stat-value">$380M</div>
                <div class="stat-label">Total Revenue</div>
            </div>
            <div class="stat">
                <div class="stat-value">+8.7%</div>
                <div class="stat-label">YoY Growth</div>
            </div>
            <div class="stat">
                <div class="stat-value">5</div>
                <div class="stat-label">Segments</div>
            </div>
        </div>
    </div>
    
    <script>
        const data = [{"segment":"Cloud Services","revenue":145,"growth":25.3,"color":"#0ea5e9"},{"segment":"Software Licenses","revenue":89,"growth":-2.1,"color":"#10b981"},{"segment":"Hardware","revenue":67,"growth":-8.5,"color":"#f59e0b"},{"segment":"Consulting","revenue":45,"growth":12.7,"color":"#8b5cf6"},{"segment":"Support","revenue":34,"growth":5.2,"color":"#ef4444"}];
        
        // Calculate angles for donut chart
        const total = d3.sum(data, d => d.revenue);
        let cumulative = 0;
        
        const donutData = data.map(d => {
            const startAngle = cumulative * 2 * Math.PI / total;
            cumulative += d.revenue;
            const endAngle = cumulative * 2 * Math.PI / total;
            
            return {
                ...d,
                startAngle,
                endAngle,
                percentage: Math.round(d.revenue / total * 100)
            };
        });
        
        const plot = Plot.plot({
            marks: [
                // Donut segments
                Plot.arc(donutData, {
                    innerRadius: 80,
                    outerRadius: 140,
                    startAngle: "startAngle",
                    endAngle: "endAngle", 
                    fill: "segment",
                    stroke: "white",
                    strokeWidth: 3,
                    title: d => `${d.segment}\nðŸ’° Revenue: $${d.revenue}M (${d.percentage}%)\nðŸ“ˆ Growth: ${d.growth > 0 ? '+' : ''}${d.growth}% YoY`
                }),
                
                // Center text
                Plot.text([{text: "$380M", y: -5}], {
                    x: 0,
                    y: "y",
                    text: "text",
                    fontSize: 24,
                    fontWeight: "bold",
                    textAnchor: "middle",
                    fill: "#1e293b"
                }),
                Plot.text([{text: "Total Revenue", y: 15}], {
                    x: 0,
                    y: "y", 
                    text: "text",
                    fontSize: 14,
                    textAnchor: "middle",
                    fill: "#64748b"
                })
            ],
            width: 500,
            height: 400,
            x: {domain: [-200, 200], axis: null},
            y: {domain: [-200, 200], axis: null},
            color: {
                domain: data.map(d => d.segment),
                range: ["#0ea5e9", "#10b981", "#f59e0b", "#8b5cf6", "#ef4444"],
                legend: true
            },
            marginTop: 20,
            marginBottom: 20,
            marginLeft: 100,
            marginRight: 100
        });
        
        document.getElementById("plot").appendChild(plot);
    </script>
</body>
</html>
