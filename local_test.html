<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>Local Plot.js Test</title>
    <script src="inst/htmlwidgets/lib/plot/plot.min.js"></script>
    <style>
        body { 
            font-family: sans-serif; 
            padding: 20px;
            line-height: 1.6;
        }
        .success { color: green; }
        .error { color: red; }
        .info { color: blue; }
        .plot-container {
            border: 2px solid #ddd;
            padding: 15px;
            margin: 20px 0;
            background-color: #f9f9f9;
        }
    </style>
</head>
<body>
    <h1>Local Plot.js Library Test</h1>
    <div id="status"></div>
    
    <div class="plot-container">
        <h3>Test 1: Simple Scatter Plot</h3>
        <div id="plot1"></div>
    </div>
    
    <div class="plot-container">
        <h3>Test 2: Cars Data (Like R Example)</h3>
        <div id="plot2"></div>
    </div>
    
    <script>
        const status = document.getElementById('status');
        
        function log(message, className = '') {
            const p = document.createElement('p');
            p.textContent = message;
            if (className) p.className = className;
            status.appendChild(p);
            console.log(message);
        }
        
        log('Testing local Plot.js library...', 'info');
        
        if (typeof Plot === 'undefined') {
            log('✗ Plot library not loaded from local file', 'error');
            log('Check that inst/htmlwidgets/lib/plot/plot.min.js exists and is accessible', 'error');
        } else {
            log('✓ Plot library loaded successfully from local file!', 'success');
            log('Available Plot functions: ' + Object.keys(Plot).slice(0, 10).join(', ') + '...', 'info');
            
            try {
                // Test 1: Simple data
                log('Creating Test 1: Simple scatter plot...', 'info');
                const simpleData = [
                    {x: 1, y: 2},
                    {x: 2, y: 4},
                    {x: 3, y: 3},
                    {x: 4, y: 5},
                    {x: 5, y: 6}
                ];
                
                const plot1 = Plot.plot({
                    marks: [
                        Plot.dot(simpleData, {x: "x", y: "y", fill: "steelblue", r: 8})
                    ],
                    grid: true,
                    width: 500,
                    height: 300,
                    marginLeft: 40,
                    marginBottom: 40
                });
                
                document.getElementById('plot1').appendChild(plot1);
                log('✓ Test 1 successful', 'success');
                
                // Test 2: Cars-like data
                log('Creating Test 2: Cars data scatter plot...', 'info');
                const carsData = [
                    {speed: 4, dist: 2}, {speed: 7, dist: 4}, {speed: 8, dist: 16},
                    {speed: 9, dist: 10}, {speed: 10, dist: 18}, {speed: 11, dist: 17},
                    {speed: 12, dist: 14}, {speed: 13, dist: 26}, {speed: 14, dist: 26},
                    {speed: 15, dist: 20}, {speed: 16, dist: 32}, {speed: 17, dist: 32},
                    {speed: 18, dist: 40}, {speed: 19, dist: 35}, {speed: 20, dist: 48}
                ];
                
                const plot2 = Plot.plot({
                    marks: [
                        Plot.dot(carsData, {
                            x: "speed", 
                            y: "dist", 
                            fill: "orange", 
                            r: 6,
                            stroke: "red",
                            strokeWidth: 1
                        }),
                        Plot.line(carsData, {
                            x: "speed",
                            y: "dist",
                            stroke: "blue",
                            strokeWidth: 2,
                            strokeOpacity: 0.7
                        })
                    ],
                    grid: true,
                    width: 600,
                    height: 400,
                    marginLeft: 50,
                    marginBottom: 50,
                    x: {label: "Speed (mph) →"},
                    y: {label: "↑ Stopping Distance (ft)"}
                });
                
                document.getElementById('plot2').appendChild(plot2);
                log('✓ Test 2 successful', 'success');
                log('✓ All tests passed! Local Plot.js library is working.', 'success');
                
            } catch (e) {
                log('✗ Error creating plots: ' + e.message, 'error');
                console.error('Full error:', e);
            }
        }
    </script>
</body>
</html>